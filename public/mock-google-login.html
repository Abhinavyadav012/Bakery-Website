<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in - Google Accounts</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Google Sans', Roboto, Arial, sans-serif;
            background: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 450px;
            padding: 48px 40px 36px;
            border: 1px solid #dadce0;
            border-radius: 8px;
        }
        .google-logo {
            text-align: center;
            margin-bottom: 16px;
        }
        .google-logo svg {
            height: 24px;
        }
        h1 {
            font-size: 24px;
            font-weight: 400;
            color: #202124;
            text-align: center;
            margin-bottom: 8px;
        }
        .subtitle {
            text-align: center;
            color: #202124;
            font-size: 16px;
            margin-bottom: 24px;
        }
        .app-info {
            text-align: center;
            color: #5f6368;
            font-size: 14px;
            margin-bottom: 32px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .app-info strong {
            color: #202124;
        }
        .input-group {
            margin-bottom: 24px;
        }
        .input-group label {
            display: block;
            font-size: 12px;
            color: #5f6368;
            margin-bottom: 8px;
        }
        .input-group input {
            width: 100%;
            padding: 13px 15px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }
        .input-group input:focus {
            border-color: #1a73e8;
            border-width: 2px;
            padding: 12px 14px;
        }
        .input-group input::placeholder {
            color: #80868b;
        }
        .error-message {
            color: #d93025;
            font-size: 12px;
            margin-top: 8px;
            display: none;
        }
        .error-message.show {
            display: block;
        }
        .forgot-email {
            color: #1a73e8;
            font-size: 14px;
            text-decoration: none;
            font-weight: 500;
        }
        .forgot-email:hover {
            text-decoration: underline;
        }
        .guest-mode {
            color: #5f6368;
            font-size: 14px;
            margin-top: 16px;
        }
        .guest-mode a {
            color: #1a73e8;
            text-decoration: none;
            font-weight: 500;
        }
        .buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 32px;
        }
        .create-account {
            color: #1a73e8;
            font-size: 14px;
            text-decoration: none;
            font-weight: 500;
        }
        .create-account:hover {
            text-decoration: underline;
        }
        .next-btn {
            background: #1a73e8;
            color: #fff;
            border: none;
            padding: 10px 24px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
        }
        .next-btn:hover {
            background: #1557b0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        .next-btn:disabled {
            background: #94c4f8;
            cursor: not-allowed;
        }
        .privacy-terms {
            text-align: center;
            margin-top: 80px;
            font-size: 12px;
            color: #5f6368;
        }
        .privacy-terms a {
            color: #5f6368;
            text-decoration: none;
            margin: 0 8px;
        }
        .privacy-terms a:hover {
            text-decoration: underline;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .loading.show {
            display: block;
        }
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1a73e8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .account-list {
            margin-bottom: 24px;
        }
        .account-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 1px solid #dadce0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .account-item:hover {
            background: #f8f9fa;
        }
        .account-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4285f4, #ea4335);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 500;
            margin-right: 16px;
        }
        .account-info {
            flex: 1;
        }
        .account-name {
            font-size: 14px;
            color: #202124;
            font-weight: 500;
        }
        .account-email {
            font-size: 12px;
            color: #5f6368;
        }
        .use-another {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: #1a73e8;
            font-size: 14px;
            cursor: pointer;
            border-radius: 8px;
        }
        .use-another:hover {
            background: #f8f9fa;
        }
        .use-another svg {
            margin-right: 16px;
        }
        .form-section {
            display: none;
        }
        .form-section.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="google-logo">
            <svg viewBox="0 0 75 24" width="75" height="24">
                <g>
                    <path fill="#4285F4" d="M0 12.19c0-3.23 2.57-5.84 5.74-5.84 1.73 0 2.97.68 3.89 1.54l-1.09 1.12c-.66-.62-1.55-1.1-2.8-1.1-2.29 0-4.08 1.85-4.08 4.27s1.79 4.27 4.08 4.27c1.48 0 2.33-.6 2.87-1.15.44-.44.73-1.08.84-1.95H5.74v-1.57h5.37c.05.3.09.65.09 1.03 0 1.24-.33 2.76-1.41 3.85-1.05 1.11-2.39 1.7-4.05 1.7-3.17 0-5.74-2.61-5.74-5.84z"/>
                    <path fill="#EA4335" d="M18.28 9.27c-2.38 0-4.32 1.82-4.32 4.34 0 2.5 1.94 4.34 4.32 4.34s4.32-1.84 4.32-4.34c0-2.52-1.94-4.34-4.32-4.34zm0 6.96c-1.3 0-2.43-1.09-2.43-2.62 0-1.55 1.13-2.62 2.43-2.62 1.3 0 2.43 1.07 2.43 2.62 0 1.53-1.13 2.62-2.43 2.62z"/>
                    <path fill="#FBBC05" d="M29.88 9.27c-2.38 0-4.32 1.82-4.32 4.34 0 2.5 1.94 4.34 4.32 4.34s4.32-1.84 4.32-4.34c0-2.52-1.94-4.34-4.32-4.34zm0 6.96c-1.3 0-2.43-1.09-2.43-2.62 0-1.55 1.13-2.62 2.43-2.62 1.3 0 2.43 1.07 2.43 2.62 0 1.53-1.13 2.62-2.43 2.62z"/>
                    <path fill="#4285F4" d="M41.37 9.27c-2.24 0-4.08 1.78-4.08 4.34 0 2.54 1.84 4.34 4.08 4.34 1.25 0 2.19-.49 2.87-1.24v.94c0 1.62-1.01 2.52-2.61 2.52-1.28 0-2.06-.93-2.37-1.72l-1.65.69c.5 1.21 1.84 2.69 4.02 2.69 2.34 0 4.32-1.47 4.32-5.06V9.53h-1.79v.87c-.68-.74-1.62-1.13-2.79-1.13zm.2 6.96c-1.3 0-2.39-1.09-2.39-2.62 0-1.55 1.09-2.62 2.39-2.62 1.28 0 2.28 1.1 2.28 2.64 0 1.52-1 2.6-2.28 2.6z"/>
                    <path fill="#34A853" d="M48.06 5.69v11.85h1.89V5.69h-1.89z"/>
                    <path fill="#EA4335" d="M55.78 16.23c-1.21 0-2.07-.56-2.63-1.66l7.25-3.02-.24-.62c-.45-1.21-1.82-3.45-4.62-3.45-2.78 0-5.09 2.19-5.09 4.34 0 2.43 1.93 4.34 5.35 4.34 2.47 0 3.9-1.52 4.49-2.41l-1.47-.98c-.49.73-1.16 1.46-3.04 1.46zm-.19-5.34c.95 0 1.75.48 2.02 1.17l-4.84 2.02c-.11-1.59 1.29-3.19 2.82-3.19z"/>
                </g>
            </svg>
        </div>
        
        <!-- Choose Account Section -->
        <div id="chooseSection" class="form-section active">
            <h1>Choose an account</h1>
            <p class="subtitle">to continue to <strong>Perfect Bakery</strong></p>
            
            <div class="account-list" id="accountList">
                <!-- Saved accounts will appear here -->
            </div>
            
            <div class="use-another" id="useAnother">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#1a73e8">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                </svg>
                Use another account
            </div>
        </div>
        
        <!-- Email Input Section -->
        <div id="emailSection" class="form-section">
            <h1>Sign in</h1>
            <p class="subtitle">to continue to <strong>Perfect Bakery</strong></p>
            
            <div class="app-info">
                This app wants to access your <strong>Google Account</strong> to verify your identity
            </div>
            
            <form id="emailForm">
                <div class="input-group">
                    <input type="email" id="email" placeholder="Email" required>
                    <p class="error-message" id="emailError">Please enter a valid email address</p>
                </div>
                
                <a href="#" class="forgot-email">Forgot email?</a>
                
                <div class="guest-mode">
                    Not your computer? Use Guest mode to sign in privately. <a href="#">Learn more</a>
                </div>
                
                <div class="buttons">
                    <a href="#" class="create-account" id="backBtn">Back</a>
                    <button type="submit" class="next-btn" id="nextBtn">Next</button>
                </div>
            </form>
        </div>
        
        <!-- Password Section -->
        <div id="passwordSection" class="form-section">
            <h1>Welcome</h1>
            <p class="subtitle" id="welcomeEmail"></p>
            
            <form id="passwordForm">
                <div class="input-group">
                    <input type="password" id="password" placeholder="Enter your password" required>
                    <p class="error-message" id="passwordError">Wrong password. Try again.</p>
                </div>
                
                <a href="#" class="forgot-email">Forgot password?</a>
                
                <div class="buttons">
                    <a href="#" class="create-account" id="backToEmail">Back</a>
                    <button type="submit" class="next-btn" id="signInBtn">Sign in</button>
                </div>
            </form>
        </div>
        
        <!-- Loading Section -->
        <div id="loadingSection" class="form-section">
            <div class="loading show">
                <div class="spinner"></div>
                <p>Signing you in...</p>
            </div>
        </div>
        
        <div class="privacy-terms">
            <a href="#">Privacy</a>
            <a href="#">Terms</a>
        </div>
    </div>
    
    <script>
        // Sections
        const chooseSection = document.getElementById('chooseSection');
        const emailSection = document.getElementById('emailSection');
        const passwordSection = document.getElementById('passwordSection');
        const loadingSection = document.getElementById('loadingSection');
        
        // Elements
        const accountList = document.getElementById('accountList');
        const useAnother = document.getElementById('useAnother');
        const emailForm = document.getElementById('emailForm');
        const passwordForm = document.getElementById('passwordForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const welcomeEmail = document.getElementById('welcomeEmail');
        const backBtn = document.getElementById('backBtn');
        const backToEmail = document.getElementById('backToEmail');
        
        let currentEmail = '';
        
        // Show section
        function showSection(section) {
            [chooseSection, emailSection, passwordSection, loadingSection].forEach(s => {
                s.classList.remove('active');
            });
            section.classList.add('active');
        }
        
        // Check for saved accounts
        function loadSavedAccounts() {
            const saved = localStorage.getItem('googleAccounts');
            if (saved) {
                const accounts = JSON.parse(saved);
                if (accounts.length > 0) {
                    accountList.innerHTML = accounts.map(acc => `
                        <div class="account-item" data-email="${acc.email}" data-name="${acc.name}">
                            <div class="account-avatar">${acc.name.charAt(0).toUpperCase()}</div>
                            <div class="account-info">
                                <div class="account-name">${acc.name}</div>
                                <div class="account-email">${acc.email}</div>
                            </div>
                        </div>
                    `).join('');
                    
                    // Add click handlers
                    document.querySelectorAll('.account-item').forEach(item => {
                        item.addEventListener('click', () => {
                            currentEmail = item.dataset.email;
                            welcomeEmail.textContent = currentEmail;
                            showSection(passwordSection);
                        });
                    });
                    
                    showSection(chooseSection);
                    return;
                }
            }
            showSection(emailSection);
        }
        
        // Use another account
        useAnother.addEventListener('click', () => {
            showSection(emailSection);
        });
        
        // Back buttons
        backBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const saved = localStorage.getItem('googleAccounts');
            if (saved && JSON.parse(saved).length > 0) {
                showSection(chooseSection);
            } else {
                window.location.href = '/login.html';
            }
        });
        
        backToEmail.addEventListener('click', (e) => {
            e.preventDefault();
            showSection(emailSection);
        });
        
        // Email form
        emailForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = emailInput.value.trim();
            
            if (!email || !email.includes('@')) {
                document.getElementById('emailError').classList.add('show');
                return;
            }
            
            document.getElementById('emailError').classList.remove('show');
            currentEmail = email;
            welcomeEmail.textContent = email;
            showSection(passwordSection);
        });
        
        // Password form - accepts any password
        passwordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = passwordInput.value;
            
            if (!password || password.length < 1) {
                document.getElementById('passwordError').classList.add('show');
                return;
            }
            
            document.getElementById('passwordError').classList.remove('show');
            showSection(loadingSection);
            
            // Extract name from email
            const namePart = currentEmail.split('@')[0];
            const firstName = namePart.split('.')[0] || namePart;
            const lastName = namePart.split('.')[1] || '';
            
            // Save to localStorage for future "quick sign in"
            const saved = localStorage.getItem('googleAccounts');
            const accounts = saved ? JSON.parse(saved) : [];
            if (!accounts.find(a => a.email === currentEmail)) {
                accounts.push({
                    email: currentEmail,
                    name: firstName.charAt(0).toUpperCase() + firstName.slice(1)
                });
                localStorage.setItem('googleAccounts', JSON.stringify(accounts));
            }
            
            // Call the mock OAuth endpoint
            try {
                const response = await fetch('/auth/mock-google', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: currentEmail,
                        firstName: firstName.charAt(0).toUpperCase() + firstName.slice(1),
                        lastName: lastName.charAt(0).toUpperCase() + lastName.slice(1),
                        picture: null
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Store user in sessionStorage for React to pick up
                    sessionStorage.setItem('oauthSuccess', JSON.stringify(data.user));
                    window.location.href = '/';
                } else {
                    showSection(passwordSection);
                    document.getElementById('passwordError').textContent = data.message || 'Authentication failed';
                    document.getElementById('passwordError').classList.add('show');
                }
            } catch (error) {
                console.error('Auth error:', error);
                showSection(passwordSection);
                document.getElementById('passwordError').textContent = 'Connection error. Please try again.';
                document.getElementById('passwordError').classList.add('show');
            }
        });
        
        // Initialize
        loadSavedAccounts();
    </script>
</body>
</html>
